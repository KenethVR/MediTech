<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MediTech</title>
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <body
        style="background: linear-gradient(to right, #e0f7fa, #ffffff); min-height: 100vh;">
        <div th:replace="fragments/navbar/navbar :: navbar"></div>

        <div class="container my-5">
            <h2 class="text-center mb-4 fw-bold text-primary">MediTech - Sistema
                de Gestión Hospitalaria</h2>
            <div class="row">
                <div class="col-md-12">
                    <h1 class="text-center mt-4">Administrar
                        Pacientes</h1>
                    <div class="container mt-4">
                        <table
                            class="table table-striped table-bordered table-hover">
                            <thead class="table-info text-center">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Cédula</th>
                                    <th scope="col">Área de
                                        Servicio</th>
                                    <th scope="col">Estado</th>
                                    <th scope="col">Administración</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-pacientes-body text-center">
                                <!-- Las filas son insertadas de manera dinamica según los datos disponibles, se cargan mediante un API REST -->
                                <tr>

                                    <th scope="row">1</th>
                                    <td class="text-center">Keneth Vargas</td>
                                    <td class="text-center">305540037</td>
                                    <td class="text-center">Emergencias</td>
                                    <td class="text-center"><span
                                            class="badge text-bg-success">En
                                            cola</span></td>
                                    <td class="text-center">
                                        <button
                                            class="btn btn-sm btn-warning me-1"
                                            onclick="modificarPaciente('${cliente.cedula}')">Modificar</button>
                                        <button class="btn btn-sm btn-danger"
                                            onclick="eliminarPaciente('${cliente.cedula}', '${cliente.servicio}')">Eliminar</button>
                                    </td>
                                </tr>

                                <tr>
                                    <th scope="row">2</th>
                                    <td class="text-center">Andres Hernadez</td>
                                    <td class="text-center">123456789</td>
                                    <td class="text-center">Cirugia</td>
                                    <td class="text-center"><span
                                            class="badge text-bg-success">En
                                            cola</span></td>
                                    <td class="text-center">
                                        <button
                                            class="btn btn-sm btn-warning me-1"
                                            onclick="modificarPaciente('${cliente.cedula}')">Modificar</button>
                                        <button class="btn btn-sm btn-danger"
                                            onclick="eliminarPaciente('${cliente.cedula}', '${cliente.servicio}')">Eliminar</button>
                                    </td>
                                </tr>

                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>

    </body>
    <!--  
    <script>
                function cargarPacientes() {
                    fetch('/api/simulacion/servicios')
                        .then(response => response.json())
                        .then(servicios => {
                            const tbody = document.getElementById('tabla-pacientes-body');
                            tbody.innerHTML = ''; // Limpiar tabla

                            let contador = 1;

                            servicios.forEach(servicio => {
                                fetch(`/api/simulacion/cola/${servicio}`)
                                    .then(response => response.json())
                                    .then(clientes => {
                                        clientes.forEach(cliente => {
                                            const row = document.createElement('tr');
                                            row.innerHTML = `
                                                <th scope="row">${contador++}</th>
                                                <td>${cliente.nombre}</td>
                                                <td>${cliente.cedula}</td>
                                                <td>${cliente.servicio}</td>
                                                <td><span class="badge text-bg-success">En cola</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-warning me-1" onclick="modificarPaciente('${cliente.cedula}')">Modificar</button>
                                                    <button class="btn btn-sm btn-danger" onclick="eliminarPaciente('${cliente.cedula}', '${cliente.servicio}')">Eliminar</button>
                                                </td>
                                            `;
                                            tbody.appendChild(row);
                                        });
                                    })
                                    .catch(error => console.error(`Error cargando cola de ${servicio}:`, error));
                            });
                        })
                        .catch(error => console.error('Error al cargar servicios:', error));
                }

                function eliminarPaciente(cedula, servicio) {
                    fetch(`/api/simulacion/eliminar?cedula=${encodeURIComponent(cedula)}&servicio=${encodeURIComponent(servicio)}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (!response.ok) throw new Error('No se pudo eliminar el paciente');
                        return response.text();
                    })
                    .then(mensaje => {
                        Swal.fire('Eliminado', mensaje, 'success');
                        cargarPacientes();
                    })
                    .catch(error => {
                        Swal.fire('Error', error.message, 'error');
                    });
                }

                function modificarPaciente(cedula) {
                    fetch('/api/simulacion/servicios')
                        .then(res => res.json())
                        .then(servicios => {
                            let encontrado = null;
                            const promesas = servicios.map(servicio =>
                                fetch(`/api/simulacion/cola/${servicio}`)
                                    .then(res => res.json())
                                    .then(clientes => {
                                        clientes.forEach(cliente => {
                                            if (cliente.cedula === cedula) encontrado = cliente;
                                        });
                                    })
                            );
                            Promise.all(promesas).then(() => {
                                if (!encontrado) {
                                    Swal.fire('No encontrado', 'Paciente no encontrado para modificar', 'error');
                                    return;
                                }

                                Swal.fire({
                                    title: 'Modificar Paciente',
                                    html: `
                                        <input id="swal-nombre" class="swal2-input" placeholder="Nombre" value="${encontrado.nombre}">
                                        <input id="swal-cedula" class="swal2-input" placeholder="Cédula" value="${encontrado.cedula}" disabled>
                                        <select id="swal-servicio" class="swal2-select" disabled>
                                            ${servicios.map(serv => `
                                                <option value="${serv}" ${encontrado.servicio === serv ? 'selected' : ''}>${serv}</option>
                                            `).join('')}
                                        </select>
                                    `,
                                    focusConfirm: false,
                                    preConfirm: () => {
                                        const nombre = document.getElementById('swal-nombre').value.trim();
                                        const cedula = document.getElementById('swal-cedula').value.trim();
                                        const servicio = document.getElementById('swal-servicio').value;

                                        if (!servicio) {
                                            Swal.showValidationMessage("Debe seleccionar un servicio");
                                            return false;
                                        }

                                        return { nombre, cedula, servicio };
                                    }
                                })
                                .then((result) => {
                                    if (result.isConfirmed) {
                                        const pacienteModificado = result.value;
                                        console.log("Datos enviados al backend:", pacienteModificado);
                                        fetch('/api/simulacion/modificar', {
                                            method: 'PUT',
                                            headers: {
                                                'Content-Type': 'application/json'
                                            },
                                            body: JSON.stringify(pacienteModificado)
                                        })
                                        .then(res => {
                                            if (!res.ok) throw new Error('Error al modificar paciente');
                                            return res.text();
                                        })
                                        .then(msg => {
                                            Swal.fire('Modificado', msg, 'success');
                                            cargarPacientes();
                                        })
                                        .catch(err => {
                                            Swal.fire('Error', err.message, 'error');
                                        });
                                    }
                                });
                            });
                        });
                }

                // Llamar cuando se cargue la página
                document.addEventListener('DOMContentLoaded', cargarPacientes);
            </script>
-->
</html>