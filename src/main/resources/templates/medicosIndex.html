<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MediTech</title>
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body
        style="background: linear-gradient(to right, #e0f7fa, #ffffff); min-height: 100vh;">
        <div th:replace="fragments/navbar/navbar :: navbar"></div>

        <div class="container my-5">
            <h2 class="text-center mb-4 fw-bold text-primary">MediTech - Sistema
                de Gestión Hospitalaria</h2>

            <!-- Mantenimiento de Médicos -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="fw-semibold">Mantenimiento de Médicos</h4>
                <button class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#modalMedico">
                    Registrar Médico
                </button>
            </div>

            <div class="row" id="cardContainer">
                <!-- Tarjetas de médicos -->
            </div>

            <!-- Modal -->
            <div class="modal fade" id="modalMedico" tabindex="-1"
                aria-labelledby="modalMedicoLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content shadow">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title"
                                id="modalMedicoLabel">Registrar Médico</h5>
                            <button type="button"
                                class="btn-close btn-close-white"
                                data-bs-dismiss="modal"></button>
                        </div>
                        <form id="formMedico">
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="cedula"
                                        class="form-label">Cédula</label>
                                    <input type="text" class="form-control"
                                        id="cedula"
                                        pattern="^\d{9}$"
                                        maxlength="9"
                                        title="La cédula debe contener exactamente 9 dígitos numéricos"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <label for="nombre"
                                        class="form-label">Nombre</label>
                                    <input type="text" class="form-control"
                                        id="nombre"
                                        pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ ]+$"
                                        title="El nombre debe contener solo letras y espacios"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <label for="sexo"
                                        class="form-label">Sexo</label>
                                    <select class="form-select" id="sexo"
                                        required>
                                        <option value selected
                                            disabled>Seleccione</option>
                                        <option>Masculino</option>
                                        <option>Femenino</option>
                                        <option>Otro</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="edad"
                                        class="form-label">Edad</label>
                                    <input type="number" class="form-control"
                                        id="edad"
                                        min="18" max="100"
                                        title="Edad válida entre 18 y 100 años"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <label for="servicio"
                                        class="form-label">Servicio que
                                        brinda</label>
                                    <input type="text" class="form-control"
                                        id="servicio" required>
                                </div>
                                <!-- El campo "Activo" se elimina, los médicos se registran activos por defecto -->
                            </div>
                            <div class="modal-footer">
                                <button type="submit"
                                    class="btn btn-success">Guardar</button>
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
        <script>
            const form = document.getElementById('formMedico');
            let editMode = false;
            let medicoEditando = null;  
            const cardContainer = document.getElementById('cardContainer');

            function crearCard(medico) {
                const card = document.createElement('div');
                card.className = 'col-md-4 mb-4';

                let titulo = 'Dr.';
                if (medico.sexo && medico.sexo.toLowerCase() === 'femenino') {
                    titulo = 'Dra.';
                }

                card.innerHTML = `
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${titulo} ${medico.nombre}</h5>
                            <p class="card-text mb-1"><strong>Cédula:</strong> ${medico.cedula}</p>
                            <p class="card-text mb-1"><strong>Sexo:</strong> ${medico.sexo}</p>
                            <p class="card-text mb-1"><strong>Edad:</strong> ${medico.edad}</p>
                            <p class="card-text mb-1"><strong>Servicio:</strong> ${medico.servicio}</p>
                            <span class="badge ${medico.activo ? 'bg-success' : 'bg-secondary'}">
                                ${medico.activo ? 'Activo' : 'Inactivo'}
                            </span>
                            <div class="mt-3 d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-primary" onclick="modificarMedico(this)">Modificar</button>
                                <button class="btn btn-sm ${medico.activo ? 'btn-outline-danger' : 'btn-outline-success'}" onclick="toggleEstadoMedico(this)">
                                    ${medico.activo ? 'Desactivar' : 'Activar'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                cardContainer.appendChild(card);
            }

            form.addEventListener('submit', function (e) {
            e.preventDefault();

            const medico = {
                cedula: document.getElementById('cedula').value,
                nombre: document.getElementById('nombre').value,
                sexo: document.getElementById('sexo').value,
                edad: document.getElementById('edad').value,
                servicio: document.getElementById('servicio').value,
                activo: true
            };

            if (editMode && medicoEditando) {
                let titulo = 'Dr.';
                if (medico.sexo.toLowerCase() === 'femenino') {
                    titulo = 'Dra.';
                }

                const cardBody = medicoEditando.querySelector('.card-body');
                cardBody.querySelector('.card-title').textContent = `${titulo} ${medico.nombre}`;
                cardBody.querySelector('.card-text:nth-child(2)').innerHTML = `<strong>Cédula:</strong> ${medico.cedula}`;
                cardBody.querySelector('.card-text:nth-child(3)').innerHTML = `<strong>Sexo:</strong> ${medico.sexo}`;
                cardBody.querySelector('.card-text:nth-child(4)').innerHTML = `<strong>Edad:</strong> ${medico.edad}`;
                cardBody.querySelector('.card-text:nth-child(5)').innerHTML = `<strong>Servicio:</strong> ${medico.servicio}`;
                
                editMode = false;
                medicoEditando = null;
            } else {
                crearCard(medico);
            }
            form.reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalMedico'));
            modal.hide();
        });

            const medicosFake = [
                { cedula: '123456789', nombre: 'Ana Ramírez', sexo: 'Femenino', edad: 42, servicio: 'Pediatría', activo: true },
                { cedula: '987654321', nombre: 'Carlos Méndez', sexo: 'Masculino', edad: 50, servicio: 'Cardiología', activo: true },
                { cedula: '456789123', nombre: 'Sofía León', sexo: 'Femenino', edad: 35, servicio: 'Ginecología', activo: false }
            ];

            medicosFake.forEach(crearCard);

            // Función para activar/desactivar médico dinámicamente
            function toggleEstadoMedico(button) {
                const cardBody = button.closest('.card-body');
                const badge = cardBody.querySelector('.badge');

                const esActivo = badge.textContent.trim() === 'Activo';

                if (esActivo) {
                    badge.className = 'badge bg-secondary';
                    badge.textContent = 'Inactivo';
                    button.textContent = 'Activar';
                    button.classList.remove('btn-outline-danger');
                    button.classList.add('btn-outline-success');
                } else {
                    badge.className = 'badge bg-success';
                    badge.textContent = 'Activo';
                    button.textContent = 'Desactivar';
                    button.classList.remove('btn-outline-success');
                    button.classList.add('btn-outline-danger');
                }
            }

            // Función para modificar médico (aún no implementada)
            function modificarMedico(button) {
            const card = button.closest('.card');
            const cedula = card.querySelector('.card-text:nth-child(2)').textContent.split(': ')[1];
            const nombre = card.querySelector('.card-title').textContent.replace(/^(Dr\.|Dra\.)\s*/, '');
            const sexo = card.querySelector('.card-text:nth-child(3)').textContent.split(': ')[1];
            const edad = card.querySelector('.card-text:nth-child(4)').textContent.split(': ')[1];
            const servicio = card.querySelector('.card-text:nth-child(5)').textContent.split(': ')[1];

            document.getElementById('cedula').value = cedula;
            document.getElementById('nombre').value = nombre;
            document.getElementById('sexo').value = sexo;
            document.getElementById('edad').value = edad;
            document.getElementById('servicio').value = servicio;

            editMode = true;
            medicoEditando = card;

            const modal = new bootstrap.Modal(document.getElementById('modalMedico'));
            modal.show();
        }
        </script>
    </body>

</html>